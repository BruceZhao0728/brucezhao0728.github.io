<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="description" content="My Blog Posts">
    <title>Blog - Zichen's Website</title>
    <link rel="icon" type="image/webp" href="img/index/avatar.webp">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- ÂØºËà™Ê†èÂç†‰ΩçÁ¨¶ -->
    <div id="navbar-placeholder"></div>

    <!-- ‰∏ªÂÜÖÂÆπ -->
    <main class="main-content">
        <div class="container">
            <section class="section">
                <h1 class="text-center" id="page-title">Blog Posts | ÊàëÁöÑÂçöÂÆ¢</h1>
                <p class="text-center hero-subtitle" id="page-subtitle">Record learning, share thoughts, deliver value</p>
            </section>

            <!-- Blog Categories -->
            <section class="section">
                <div class="text-center">
                    <div class="btn-group" style="justify-content: center;">
                        <button class="btn btn-primary" onclick="filterBlogs('all')" id="btn-all">All</button>
                        <button class="btn btn-outline" onclick="filterBlogs('tech')" id="btn-tech">Tech</button>
                        <button class="btn btn-outline" onclick="filterBlogs('life')" id="btn-life">Life</button>
                        <button class="btn btn-outline" onclick="filterBlogs('study')" id="btn-study">Study</button>
                    </div>
                </div>
            </section>

            <section class="section">
                <div class="text-center">
                    <label for="blog-sort" class="sr-only">Sort blogs</label>
                    <select id="blog-sort" class="btn btn-outline" onchange="applySort()">
                        <option value="date-desc" id="opt-date-desc">Time (newest first)</option>
                        <option value="date-asc" id="opt-date-asc">Time (oldest first)</option>
                        <option value="zh-asc" id="opt-zh-asc">Chinese title (A-Z)</option>
                        <option value="zh-desc" id="opt-zh-desc">Chinese title (Z-A)</option>
                        <option value="en-asc" id="opt-en-asc">English title (A-Z)</option>
                        <option value="en-desc" id="opt-en-desc">English title (Z-A)</option>
                    </select>
                </div>
            </section>

            <!-- Blog List -->
            <section class="section">
                <div id="blog-list" class="blog-list">
                    <!-- Blogs will be loaded dynamically via JavaScript -->
                    <div class="text-center">
                        <div class="loading"></div>
                        <p id="loading-text">Loading blog posts...</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- È°µËÑöÂç†‰ΩçÁ¨¶ -->
    <div id="footer-placeholder"></div>

    <script src="js/language.js"></script>
    <script src="js/components.js"></script>
    <script src="js/main.js"></script>
    <script>
        // Blog filtering functionality
        let allBlogs = [];
        let activeCategory = 'all';
        let activeSort = 'date-desc';

        function getBlogText(value) {
            return getLocalizedText(value);
        }

        function getBlogTitleBoth(value) {
            return getLocalizedBlogTitle(value);
        }
        
        function updateBlogPageLanguage() {
            // Update page title and subtitle
            document.getElementById('page-title').textContent = translateBlog('pageTitle') + ' | ' + blogTranslations['zh']['pageTitle'];
            document.getElementById('page-subtitle').textContent = translateBlog('pageSubtitle');
            
            // Update category buttons
            document.getElementById('btn-all').textContent = translateBlog('btnAll');
            document.getElementById('btn-tech').textContent = translateBlog('btnTech');
            document.getElementById('btn-life').textContent = translateBlog('btnLife');
            document.getElementById('btn-study').textContent = translateBlog('btnStudy');
            
            // Update sort options
            document.getElementById('opt-date-desc').textContent = translateBlog('sortTime');
            document.getElementById('opt-date-asc').textContent = translateBlog('sortTimeOld');
            document.getElementById('opt-zh-asc').textContent = translateBlog('sortZhAsc');
            document.getElementById('opt-zh-desc').textContent = translateBlog('sortZhDesc');
            document.getElementById('opt-en-asc').textContent = translateBlog('sortEnAsc');
            document.getElementById('opt-en-desc').textContent = translateBlog('sortEnDesc');
            
            // Update loading text
            document.getElementById('loading-text').textContent = translateBlog('loading');
        }
        
        async function initBlogList() {
            updateBlogPageLanguage();
            allBlogs = await loadBlogList();
            applySort();
        }
        
        function displayBlogs(blogs) {
            const blogListContainer = document.getElementById('blog-list');
            
            if (blogs.length === 0) {
                blogListContainer.innerHTML = `<div class="text-center"><p>${translateBlog('noBlogs')}</p></div>`;
                return;
            }
            
            blogListContainer.innerHTML = blogs.map(blog => {
                const title = getBlogTitleBoth(blog.title);
                const excerpt = getBlogText(blog.excerpt);
                const readTime = getBlogText(blog.readTime) || '5 min read';
                return `
                <div class="blog-card" onclick="location.href='blog-detail.html?id=${blog.id}'">
                    <div class="blog-header">
                        <h3 class="blog-title">${title}</h3>
                        <div class="blog-meta">
                            <span>üìÖ ${blog.date}</span>
                            <span>‚è±Ô∏è ${readTime}</span>
                            ${blog.category ? `<span>üìÅ ${blog.category}</span>` : ''}
                        </div>
                    </div>
                    <div class="blog-excerpt">
                        ${excerpt}
                    </div>
                    ${blog.tags ? `
                        <div class="blog-tags">
                            ${blog.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
            }).join('');
        }

        function applySort() {
            const sortSelect = document.getElementById('blog-sort');
            if (sortSelect) {
                activeSort = sortSelect.value;
            }

            const filtered = getFilteredBlogs();
            const sorted = sortBlogs(filtered, activeSort);
            displayBlogs(sorted);
        }

        function getFilteredBlogs() {
            if (activeCategory === 'all') {
                return [...allBlogs];
            }
            return allBlogs.filter(blog =>
                blog.category === activeCategory ||
                (blog.tags && blog.tags.includes(activeCategory))
            );
        }

        function sortBlogs(blogs, sortKey) {
            const [field, direction] = sortKey.split('-');
            const multiplier = direction === 'desc' ? -1 : 1;
            const dateValue = value => new Date(value).getTime() || 0;
            const currentLang = getCurrentLanguage();

            return [...blogs].sort((a, b) => {
                if (field === 'date') {
                    return (dateValue(a.date) - dateValue(b.date)) * multiplier;
                }
                if (field === 'zh') {
                    const aText = (a.title && a.title.zh) ? a.title.zh : '';
                    const bText = (b.title && b.title.zh) ? b.title.zh : '';
                    return aText.localeCompare(bText, 'zh-Hans-CN') * multiplier;
                }
                if (field === 'en') {
                    const aText = (a.title && a.title.en) ? a.title.en : '';
                    const bText = (b.title && b.title.en) ? b.title.en : '';
                    return aText.localeCompare(bText, 'en') * multiplier;
                }
                return 0;
            });
        }
        
        function filterBlogs(category) {
            // Êõ¥Êñ∞ÊåâÈíÆÊ†∑Âºè
            document.querySelectorAll('.btn-group button').forEach(btn => {
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-outline');
            });
            event.target.classList.remove('btn-outline');
            event.target.classList.add('btn-primary');
            
            // Á≠õÈÄâÂçöÂÆ¢
            activeCategory = category;
            applySort();
        }
        
        // È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñ
        window.addEventListener('DOMContentLoaded', initBlogList);
    </script>
</body>
</html>
